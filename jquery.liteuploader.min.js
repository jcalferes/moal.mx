/* liteUploader v1.4.2 | https://github.com/burt202/lite-uploader | Aaron Burtnyk (http://www.burtdev.net) */

$.fn.liteUploader=function(e){var t={script:null,allowedFileTypes:null,maxSizeInBytes:null,customParams:{},before:function(){},each:function(){},progress:function(){},success:function(){},fail:function(){}};this.change(function(n){LiteUploader.init($,$(n.currentTarget),$.extend(t,e))})};var LiteUploader={attrs:{},init:function(e,t,n){this.attrs={$:e,el:t,options:n};if(!t.attr("name")||!n.script||t.get(0).files.length===0||n.before(t.get(0).files)===false||!this.validateFiles()){this.resetInput();return}this.performUpload(this.collateFormData())},resetInput:function(){this.attrs.el.replaceWith(this.attrs.el.clone(true))},validateFiles:function(){var e=this,t=false,n=e.attrs.el.get(0).files;e.attrs.$.each(n,function(r){var i=e.findErrors(n[r]);if(e.attrs.options.each(n[r],i)===false||i.length>0){t=true}});return t?false:true},findErrors:function(e){var t=[];if(this.attrs.options.allowedFileTypes&&this.attrs.$.inArray(e.type,this.attrs.options.allowedFileTypes.split(","))===-1){t.push({type:"type",rule:this.attrs.options.allowedFileTypes,given:e.type})}if(this.attrs.options.maxSizeInBytes&&e.size>this.attrs.options.maxSizeInBytes){t.push({type:"size",rule:this.attrs.options.maxSizeInBytes,given:e.size})}return t},collateFormData:function(){var e=this,t=e.attrs.el.get(0).files,n=new FormData;if(e.attrs.el.attr("id")){n.append("liteUploader_id",e.attrs.el.attr("id"))}e.attrs.$.each(e.attrs.options.customParams,function(e,t){n.append(e,t)});e.attrs.$.each(t,function(r){n.append(e.attrs.el.attr("name")+"[]",t[r])});return n},performUpload:function(e){var t=this;t.attrs.$.ajax({xhr:function(){var e=new XMLHttpRequest;e.upload.addEventListener("progress",function(e){if(e.lengthComputable){t.attrs.options.progress(Math.floor(e.loaded/e.total*100))}},false);return e},url:t.attrs.options.script,type:"POST",data:e,processData:false,contentType:false}).always(function(){t.resetInput()}).done(function(e){t.attrs.options.success(e)}).fail(function(e){t.attrs.options.fail(e)})}}